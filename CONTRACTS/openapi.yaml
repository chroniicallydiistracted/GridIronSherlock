{
  "openapi": "3.1.0",
  "info": {
    "title": "GridIron Sherlock API",
    "version": "1.0.0",
    "description": "Contracts for the GridIron Sherlock fantasy intelligence platform.",
    "contact": {
      "name": "GridIron Sherlock",
      "url": "https://gridironsherlock.com"
    }
  },
  "servers": [
    {
      "url": "https://api.gridironsherlock.com/v1",
      "description": "Production"
    },
    {
      "url": "http://localhost:8000/v1",
      "description": "Local development"
    }
  ],
  "security": [
    {
      "sessionCookie": []
    },
    {
      "serviceToken": []
    }
  ],
  "tags": [
    {
      "name": "Account"
    },
    {
      "name": "Leagues"
    },
    {
      "name": "Teams"
    },
    {
      "name": "Players"
    },
    {
      "name": "Projections"
    },
    {
      "name": "Waivers"
    },
    {
      "name": "Trades"
    },
    {
      "name": "Live"
    },
    {
      "name": "Refresh"
    }
  ],
  "paths": {
    "/me": {
      "get": {
        "operationId": "getCurrentUser",
        "summary": "Get the authenticated user profile",
        "tags": [
          "Account"
        ],
        "responses": {
          "200": {
            "description": "Authenticated user profile",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserProfile"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/accounts/{provider}/link": {
      "post": {
        "operationId": "startAccountLink",
        "summary": "Begin OAuth linking for a provider",
        "tags": [
          "Account"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/ProviderPath"
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AccountLinkRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OAuth redirect instructions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/AccountLinkResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "429": {
            "description": "Too many requests",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/oauth/{provider}/callback": {
      "get": {
        "operationId": "handleOAuthCallback",
        "summary": "Handle OAuth callback response",
        "tags": [
          "Account"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/ProviderPath"
          },
          {
            "name": "code",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Authorization code returned by the provider."
          },
          {
            "name": "state",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            },
            "description": "Opaque state parameter for CSRF protection."
          }
        ],
        "responses": {
          "200": {
            "description": "Callback processed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OAuthCallbackResponse"
                }
              }
            }
          },
          "400": {
            "description": "Callback validation failed",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/leagues": {
      "get": {
        "operationId": "listLeagues",
        "summary": "List leagues for the authenticated user",
        "tags": [
          "Leagues"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageQuery"
          },
          {
            "$ref": "#/components/parameters/PageSizeQuery"
          },
          {
            "name": "season",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "provider",
            "in": "query",
            "required": false,
            "schema": {
              "$ref": "#/components/schemas/ProviderId"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated leagues",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LeagueListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/leagues/{leagueId}": {
      "get": {
        "operationId": "getLeague",
        "summary": "Get detailed league information",
        "tags": [
          "Leagues"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/LeagueIdPath"
          }
        ],
        "responses": {
          "200": {
            "description": "League detail",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LeagueDetail"
                }
              }
            }
          },
          "404": {
            "description": "League not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/teams/{teamId}/lineup": {
      "get": {
        "operationId": "getTeamLineup",
        "summary": "Get the tracked lineup for a team",
        "tags": [
          "Teams"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdPath"
          },
          {
            "name": "season",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "week",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 23
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Team lineup snapshot",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TeamLineupResponse"
                }
              }
            }
          },
          "404": {
            "description": "Team not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/teams/{teamId}/optimize": {
      "post": {
        "operationId": "optimizeTeamLineup",
        "summary": "Run the lineup optimizer",
        "tags": [
          "Teams"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/TeamIdPath"
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/OptimizationRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Optimization result",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OptimizationResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid optimization request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "409": {
            "description": "Optimization could not converge",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/projections": {
      "get": {
        "operationId": "listProjections",
        "summary": "List player projections",
        "tags": [
          "Projections"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageQuery"
          },
          {
            "$ref": "#/components/parameters/PageSizeQuery"
          },
          {
            "name": "season",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "week",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 23
            }
          },
          {
            "name": "position",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "leagueId",
            "in": "query",
            "required": false,
            "schema": {
              "$ref": "#/components/schemas/UUID"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated projections",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProjectionListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/players": {
      "get": {
        "operationId": "searchPlayers",
        "summary": "Search players",
        "tags": [
          "Players"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PageQuery"
          },
          {
            "$ref": "#/components/parameters/PageSizeQuery"
          },
          {
            "name": "query",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "position",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "team",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "leagueId",
            "in": "query",
            "required": false,
            "schema": {
              "$ref": "#/components/schemas/UUID"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated player summaries",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlayerListResponse"
                }
              }
            }
          }
        }
      }
    },
    "/players/{playerId}": {
      "get": {
        "operationId": "getPlayer",
        "summary": "Get player detail",
        "tags": [
          "Players"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/PlayerIdPath"
          },
          {
            "name": "leagueId",
            "in": "query",
            "required": false,
            "schema": {
              "$ref": "#/components/schemas/UUID"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Player detail",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/PlayerDetail"
                }
              }
            }
          },
          "404": {
            "description": "Player not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/waivers": {
      "get": {
        "operationId": "listWaivers",
        "summary": "List waiver recommendations",
        "tags": [
          "Waivers"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/LeagueIdQuery"
          },
          {
            "name": "week",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 23
            }
          },
          {
            "name": "season",
            "in": "query",
            "required": false,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated waiver recommendations",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/WaiverListResponse"
                }
              }
            }
          },
          "400": {
            "description": "Missing required league",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/trades/estimate": {
      "post": {
        "operationId": "estimateTrade",
        "summary": "Estimate trade fairness and impact",
        "tags": [
          "Trades"
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TradeEstimateRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Trade impact estimate",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TradeEstimateResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid trade payload",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/live/stream": {
      "get": {
        "operationId": "streamLiveImpacts",
        "summary": "Subscribe to live impact events",
        "tags": [
          "Live"
        ],
        "responses": {
          "200": {
            "description": "Server-Sent Events stream",
            "content": {
              "text/event-stream": {
                "schema": {
                  "$ref": "#/components/schemas/LiveImpactEvent"
                }
              }
            }
          }
        }
      }
    },
    "/refresh/{scope}": {
      "post": {
        "operationId": "triggerRefresh",
        "summary": "Trigger a background refresh",
        "tags": [
          "Refresh"
        ],
        "parameters": [
          {
            "$ref": "#/components/parameters/ScopePath"
          }
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RefreshRequest"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Refresh enqueued",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/RefreshResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid refresh request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "UUID": {
        "type": "string",
        "format": "uuid",
        "description": "Canonical UUID identifier."
      },
      "ProviderId": {
        "type": "string",
        "enum": [
          "espn",
          "yahoo",
          "sleeper",
          "nfl"
        ],
        "description": "Supported fantasy provider identifier."
      },
      "ScopeId": {
        "type": "string",
        "enum": [
          "leagues",
          "teams",
          "lineups",
          "projections",
          "waivers",
          "trades",
          "players",
          "live"
        ],
        "description": "Refresh scope identifier."
      },
      "ErrorResponse": {
        "type": "object",
        "required": [
          "error"
        ],
        "properties": {
          "error": {
            "type": "object",
            "required": [
              "code",
              "message"
            ],
            "properties": {
              "code": {
                "type": "string"
              },
              "message": {
                "type": "string"
              },
              "details": {
                "type": "object",
                "additionalProperties": true,
                "nullable": true
              }
            },
            "additionalProperties": false
          }
        },
        "additionalProperties": false
      },
      "Provenance": {
        "type": "object",
        "required": [
          "source",
          "asOf"
        ],
        "properties": {
          "source": {
            "type": "string",
            "description": "Data source or model name."
          },
          "asOf": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp the data was computed."
          },
          "modelVersion": {
            "type": "string",
            "nullable": true,
            "description": "Optional model or dataset version."
          },
          "notes": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "InjuryStatus": {
        "type": "object",
        "required": [
          "status",
          "updatedAt"
        ],
        "properties": {
          "status": {
            "type": "string",
            "enum": [
              "active",
              "questionable",
              "doubtful",
              "out",
              "ir",
              "suspended"
            ]
          },
          "designation": {
            "type": "string",
            "nullable": true
          },
          "updatedAt": {
            "type": "string",
            "format": "date-time"
          },
          "notes": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "PlayerSummary": {
        "type": "object",
        "required": [
          "playerId",
          "fullName",
          "position",
          "team"
        ],
        "properties": {
          "playerId": {
            "type": "string",
            "format": "uuid"
          },
          "gsisId": {
            "type": "string",
            "nullable": true
          },
          "fullName": {
            "type": "string"
          },
          "position": {
            "type": "string"
          },
          "team": {
            "type": "string",
            "nullable": true
          },
          "byeWeek": {
            "type": "integer",
            "minimum": 1,
            "maximum": 18,
            "nullable": true
          },
          "age": {
            "type": "integer",
            "minimum": 18,
            "nullable": true
          },
          "injury": {
            "$ref": "#/components/schemas/InjuryStatus",
            "nullable": true
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "ProjectionSummary": {
        "type": "object",
        "required": [
          "meanPoints",
          "p20",
          "p50",
          "p80",
          "boomProbability",
          "bustProbability"
        ],
        "properties": {
          "meanPoints": {
            "type": "number"
          },
          "p20": {
            "type": "number"
          },
          "p50": {
            "type": "number"
          },
          "p80": {
            "type": "number"
          },
          "boomProbability": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "bustProbability": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "floorPoints": {
            "type": "number",
            "nullable": true
          },
          "ceilingPoints": {
            "type": "number",
            "nullable": true
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance"
          }
        },
        "additionalProperties": false
      },
      "LinkedAccount": {
        "type": "object",
        "required": [
          "provider",
          "status",
          "scopes",
          "linkedAt",
          "needsReauth"
        ],
        "properties": {
          "provider": {
            "$ref": "#/components/schemas/ProviderId"
          },
          "status": {
            "type": "string",
            "enum": [
              "linked",
              "pending",
              "error"
            ]
          },
          "scopes": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "linkedAt": {
            "type": "string",
            "format": "date-time"
          },
          "lastSyncAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "needsReauth": {
            "type": "boolean"
          },
          "errorCode": {
            "type": "string",
            "nullable": true
          },
          "errorMessage": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "UserProfile": {
        "type": "object",
        "required": [
          "userId",
          "email",
          "createdAt",
          "accounts",
          "activeLeagueIds"
        ],
        "properties": {
          "userId": {
            "$ref": "#/components/schemas/UUID"
          },
          "email": {
            "type": "string",
            "format": "email"
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "displayName": {
            "type": "string",
            "nullable": true
          },
          "accounts": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LinkedAccount"
            }
          },
          "activeLeagueIds": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UUID"
            }
          },
          "preferences": {
            "type": "object",
            "properties": {
              "defaultLeagueId": {
                "$ref": "#/components/schemas/UUID",
                "nullable": true
              },
              "defaultView": {
                "type": "string",
                "nullable": true
              },
              "notificationOptIn": {
                "type": "boolean",
                "nullable": true
              }
            },
            "additionalProperties": false,
            "nullable": true
          },
          "featureFlags": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "additionalProperties": false
      },
      "AccountLinkRequest": {
        "type": "object",
        "properties": {
          "redirectUri": {
            "type": "string",
            "format": "uri",
            "nullable": true
          },
          "scopes": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "AccountLinkResponse": {
        "type": "object",
        "required": [
          "provider",
          "authorizationUrl",
          "state",
          "expiresAt"
        ],
        "properties": {
          "provider": {
            "$ref": "#/components/schemas/ProviderId"
          },
          "authorizationUrl": {
            "type": "string",
            "format": "uri"
          },
          "state": {
            "type": "string"
          },
          "expiresAt": {
            "type": "string",
            "format": "date-time"
          },
          "pkce": {
            "type": "object",
            "required": [
              "codeChallenge",
              "codeChallengeMethod"
            ],
            "properties": {
              "codeChallenge": {
                "type": "string"
              },
              "codeChallengeMethod": {
                "type": "string",
                "enum": [
                  "S256"
                ]
              }
            },
            "additionalProperties": false
          }
        },
        "additionalProperties": false
      },
      "OAuthCallbackResponse": {
        "type": "object",
        "required": [
          "provider",
          "status"
        ],
        "properties": {
          "provider": {
            "$ref": "#/components/schemas/ProviderId"
          },
          "status": {
            "type": "string",
            "enum": [
              "linked",
              "pending",
              "error"
            ]
          },
          "linkedAccount": {
            "$ref": "#/components/schemas/LinkedAccount",
            "nullable": true
          },
          "redirect": {
            "type": "string",
            "format": "uri",
            "nullable": true
          },
          "message": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "TeamReference": {
        "type": "object",
        "required": [
          "teamId",
          "leagueId",
          "name"
        ],
        "properties": {
          "teamId": {
            "type": "string",
            "format": "uuid"
          },
          "leagueId": {
            "type": "string",
            "format": "uuid"
          },
          "name": {
            "type": "string"
          },
          "abbreviation": {
            "type": "string",
            "nullable": true
          },
          "manager": {
            "type": "string",
            "nullable": true
          },
          "record": {
            "type": "object",
            "required": [
              "wins",
              "losses",
              "ties"
            ],
            "properties": {
              "wins": {
                "type": "integer",
                "minimum": 0
              },
              "losses": {
                "type": "integer",
                "minimum": 0
              },
              "ties": {
                "type": "integer",
                "minimum": 0
              }
            },
            "additionalProperties": false,
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "TeamStanding": {
        "type": "object",
        "required": [
          "team",
          "rank",
          "pointsFor",
          "pointsAgainst"
        ],
        "properties": {
          "team": {
            "$ref": "#/components/schemas/TeamReference"
          },
          "rank": {
            "type": "integer",
            "minimum": 1
          },
          "pointsFor": {
            "type": "number"
          },
          "pointsAgainst": {
            "type": "number"
          },
          "streak": {
            "type": "string",
            "nullable": true
          },
          "notes": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "RosterSlotRule": {
        "type": "object",
        "required": [
          "slot",
          "count"
        ],
        "properties": {
          "slot": {
            "type": "string"
          },
          "count": {
            "type": "integer",
            "minimum": 0
          }
        },
        "additionalProperties": false
      },
      "LeagueSummary": {
        "type": "object",
        "required": [
          "leagueId",
          "provider",
          "name",
          "season"
        ],
        "properties": {
          "leagueId": {
            "$ref": "#/components/schemas/UUID"
          },
          "provider": {
            "$ref": "#/components/schemas/ProviderId"
          },
          "name": {
            "type": "string"
          },
          "season": {
            "type": "integer"
          },
          "format": {
            "type": "string",
            "nullable": true
          },
          "avatarUrl": {
            "type": "string",
            "format": "uri",
            "nullable": true
          },
          "lastSyncAt": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "teams": {
            "type": "integer",
            "nullable": true
          },
          "status": {
            "type": "string",
            "enum": [
              "preseason",
              "in-season",
              "completed"
            ],
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "LeagueDetail": {
        "type": "object",
        "required": [
          "league",
          "teams",
          "scoring"
        ],
        "properties": {
          "league": {
            "$ref": "#/components/schemas/LeagueSummary"
          },
          "teams": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TeamReference"
            }
          },
          "standings": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TeamStanding"
            },
            "nullable": true
          },
          "scoring": {
            "type": "object",
            "required": [
              "type",
              "ppr"
            ],
            "properties": {
              "type": {
                "type": "string"
              },
              "ppr": {
                "type": "number"
              },
              "bonusRules": {
                "type": "array",
                "items": {
                  "type": "string"
                }
              }
            },
            "additionalProperties": false
          },
          "rosterSettings": {
            "type": "object",
            "required": [
              "slots",
              "benchSlots"
            ],
            "properties": {
              "slots": {
                "type": "array",
                "items": {
                  "$ref": "#/components/schemas/RosterSlotRule"
                }
              },
              "benchSlots": {
                "type": "integer",
                "minimum": 0
              },
              "irSlots": {
                "type": "integer",
                "minimum": 0,
                "nullable": true
              },
              "notes": {
                "type": "string",
                "nullable": true
              }
            },
            "additionalProperties": false
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance"
          }
        },
        "additionalProperties": false
      },
      "ScoringPeriod": {
        "type": "object",
        "required": [
          "season",
          "week"
        ],
        "properties": {
          "season": {
            "type": "integer",
            "minimum": 2000
          },
          "week": {
            "type": "integer",
            "minimum": 1,
            "maximum": 23
          }
        },
        "additionalProperties": false
      },
      "LeagueListResponse": {
        "type": "object",
        "required": [
          "total",
          "page",
          "pageSize",
          "items"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "minimum": 0
          },
          "page": {
            "type": "integer",
            "minimum": 1
          },
          "pageSize": {
            "type": "integer",
            "minimum": 1
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LeagueSummary"
            }
          }
        },
        "additionalProperties": false
      },
      "LineupSlot": {
        "type": "object",
        "required": [
          "slot",
          "player",
          "projected"
        ],
        "properties": {
          "slot": {
            "type": "string"
          },
          "player": {
            "$ref": "#/components/schemas/PlayerSummary"
          },
          "projected": {
            "$ref": "#/components/schemas/ProjectionSummary"
          },
          "status": {
            "type": "string",
            "enum": [
              "starting",
              "bench",
              "locked",
              "inactive"
            ],
            "default": "starting"
          },
          "actualPoints": {
            "type": "number",
            "nullable": true
          },
          "notes": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "TeamLineupResponse": {
        "type": "object",
        "required": [
          "team",
          "period",
          "lineup",
          "bench"
        ],
        "properties": {
          "team": {
            "$ref": "#/components/schemas/TeamReference"
          },
          "period": {
            "$ref": "#/components/schemas/ScoringPeriod"
          },
          "lineup": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LineupSlot"
            }
          },
          "bench": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/LineupSlot"
            }
          },
          "totalProjected": {
            "type": "number"
          },
          "totalActual": {
            "type": "number",
            "nullable": true
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance"
          }
        },
        "additionalProperties": false
      },
      "OptimizationObjective": {
        "type": "object",
        "required": [
          "focus"
        ],
        "properties": {
          "focus": {
            "type": "string",
            "enum": [
              "balanced",
              "ceiling",
              "floor"
            ]
          },
          "ceilingWeight": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "default": 0.5
          },
          "variancePenalty": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "default": 0.25
          },
          "notes": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "OptimizationConstraints": {
        "type": "object",
        "properties": {
          "lockedPlayers": {
            "type": "array",
            "items": {
              "type": "object",
              "required": [
                "slot",
                "playerId"
              ],
              "properties": {
                "slot": {
                  "type": "string"
                },
                "playerId": {
                  "$ref": "#/components/schemas/UUID"
                }
              },
              "additionalProperties": false
            }
          },
          "excludedPlayerIds": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/UUID"
            }
          },
          "maxPlayersPerTeam": {
            "type": "integer",
            "minimum": 1,
            "nullable": true
          },
          "riskTolerance": {
            "type": "string",
            "enum": [
              "low",
              "medium",
              "high"
            ],
            "default": "medium"
          },
          "benchDepth": {
            "type": "integer",
            "minimum": 0,
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "OptimizationRequest": {
        "type": "object",
        "required": [
          "period",
          "objective"
        ],
        "properties": {
          "period": {
            "$ref": "#/components/schemas/ScoringPeriod"
          },
          "objective": {
            "$ref": "#/components/schemas/OptimizationObjective"
          },
          "constraints": {
            "$ref": "#/components/schemas/OptimizationConstraints",
            "nullable": true
          },
          "context": {
            "type": "object",
            "properties": {
              "includeWaivers": {
                "type": "boolean",
                "default": false
              },
              "includeTrades": {
                "type": "boolean",
                "default": false
              },
              "notes": {
                "type": "string",
                "nullable": true
              }
            },
            "additionalProperties": false,
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "OptimizationSlot": {
        "type": "object",
        "required": [
          "slot",
          "player",
          "projection"
        ],
        "properties": {
          "slot": {
            "type": "string"
          },
          "player": {
            "$ref": "#/components/schemas/PlayerSummary"
          },
          "projection": {
            "$ref": "#/components/schemas/ProjectionSummary"
          },
          "delta": {
            "type": "number",
            "nullable": true
          },
          "reason": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "OptimizationAlternative": {
        "type": "object",
        "required": [
          "rank",
          "projectedPoints",
          "lineup"
        ],
        "properties": {
          "rank": {
            "type": "integer",
            "minimum": 1
          },
          "projectedPoints": {
            "type": "number"
          },
          "deltaFromBest": {
            "type": "number"
          },
          "lineup": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OptimizationSlot"
            }
          },
          "changes": {
            "type": "array",
            "items": {
              "type": "object",
              "required": [
                "slot",
                "inPlayerId",
                "outPlayerId"
              ],
              "properties": {
                "slot": {
                  "type": "string"
                },
                "inPlayerId": {
                  "$ref": "#/components/schemas/UUID"
                },
                "outPlayerId": {
                  "$ref": "#/components/schemas/UUID"
                }
              },
              "additionalProperties": false
            }
          }
        },
        "additionalProperties": false
      },
      "OptimizationResponse": {
        "type": "object",
        "required": [
          "runId",
          "submittedAt",
          "objective",
          "resultLineup",
          "bench"
        ],
        "properties": {
          "runId": {
            "$ref": "#/components/schemas/UUID"
          },
          "submittedAt": {
            "type": "string",
            "format": "date-time"
          },
          "objective": {
            "$ref": "#/components/schemas/OptimizationObjective"
          },
          "resultLineup": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OptimizationSlot"
            }
          },
          "bench": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OptimizationSlot"
            }
          },
          "alternatives": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/OptimizationAlternative"
            }
          },
          "insights": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance"
          }
        },
        "additionalProperties": false
      },
      "ProjectionRecord": {
        "type": "object",
        "required": [
          "player",
          "period",
          "projection"
        ],
        "properties": {
          "player": {
            "$ref": "#/components/schemas/PlayerSummary"
          },
          "period": {
            "$ref": "#/components/schemas/ScoringPeriod"
          },
          "leagueId": {
            "$ref": "#/components/schemas/UUID",
            "nullable": true
          },
          "projection": {
            "$ref": "#/components/schemas/ProjectionSummary"
          },
          "opponent": {
            "type": "object",
            "properties": {
              "team": {
                "type": "string"
              },
              "home": {
                "type": "boolean"
              },
              "impliedTotal": {
                "type": "number",
                "nullable": true
              },
              "paceRank": {
                "type": "integer",
                "nullable": true
              }
            },
            "additionalProperties": false,
            "nullable": true
          },
          "usage": {
            "type": "object",
            "properties": {
              "snapShare": {
                "type": "number",
                "nullable": true
              },
              "routeShare": {
                "type": "number",
                "nullable": true
              },
              "targetShare": {
                "type": "number",
                "nullable": true
              },
              "rushShare": {
                "type": "number",
                "nullable": true
              }
            },
            "additionalProperties": false,
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "ProjectionListResponse": {
        "type": "object",
        "required": [
          "total",
          "page",
          "pageSize",
          "items"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "minimum": 0
          },
          "page": {
            "type": "integer",
            "minimum": 1
          },
          "pageSize": {
            "type": "integer",
            "minimum": 1
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/ProjectionRecord"
            }
          }
        },
        "additionalProperties": false
      },
      "PlayerMetrics": {
        "type": "object",
        "required": [
          "season",
          "week"
        ],
        "properties": {
          "season": {
            "type": "integer"
          },
          "week": {
            "type": "integer"
          },
          "usage": {
            "type": "object",
            "properties": {
              "snapShare": {
                "type": "number",
                "nullable": true
              },
              "routeShare": {
                "type": "number",
                "nullable": true
              },
              "targetShare": {
                "type": "number",
                "nullable": true
              },
              "rushShare": {
                "type": "number",
                "nullable": true
              },
              "redZoneTouchShare": {
                "type": "number",
                "nullable": true
              }
            },
            "additionalProperties": false
          },
          "efficiency": {
            "type": "object",
            "properties": {
              "yprr": {
                "type": "number",
                "nullable": true
              },
              "adot": {
                "type": "number",
                "nullable": true
              },
              "epaPerTarget": {
                "type": "number",
                "nullable": true
              },
              "epaPerRush": {
                "type": "number",
                "nullable": true
              },
              "successRate": {
                "type": "number",
                "nullable": true
              }
            },
            "additionalProperties": false
          },
          "context": {
            "type": "object",
            "properties": {
              "paceRank": {
                "type": "integer",
                "nullable": true
              },
              "proe": {
                "type": "number",
                "nullable": true
              },
              "matchupDifficulty": {
                "type": "string",
                "nullable": true
              }
            },
            "additionalProperties": false
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance"
          }
        },
        "additionalProperties": false
      },
      "RecentGame": {
        "type": "object",
        "required": [
          "season",
          "week",
          "opponent"
        ],
        "properties": {
          "season": {
            "type": "integer"
          },
          "week": {
            "type": "integer"
          },
          "opponent": {
            "type": "string"
          },
          "fantasyPoints": {
            "type": "number",
            "nullable": true
          },
          "snapShare": {
            "type": "number",
            "nullable": true
          },
          "notes": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "PlayerDetail": {
        "type": "object",
        "required": [
          "player",
          "metrics",
          "projections"
        ],
        "properties": {
          "player": {
            "$ref": "#/components/schemas/PlayerSummary"
          },
          "metrics": {
            "$ref": "#/components/schemas/PlayerMetrics"
          },
          "projections": {
            "type": "object",
            "required": [
              "weekly"
            ],
            "properties": {
              "weekly": {
                "$ref": "#/components/schemas/ProjectionSummary"
              },
              "ros": {
                "$ref": "#/components/schemas/ProjectionSummary",
                "nullable": true
              }
            },
            "additionalProperties": false
          },
          "recentGames": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/RecentGame"
            }
          },
          "insights": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        },
        "additionalProperties": false
      },
      "PlayerListResponse": {
        "type": "object",
        "required": [
          "total",
          "page",
          "pageSize",
          "items"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "minimum": 0
          },
          "page": {
            "type": "integer",
            "minimum": 1
          },
          "pageSize": {
            "type": "integer",
            "minimum": 1
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/PlayerSummary"
            }
          }
        },
        "additionalProperties": false
      },
      "FAABRange": {
        "type": "object",
        "required": [
          "low",
          "medium",
          "high"
        ],
        "properties": {
          "low": {
            "type": "number"
          },
          "medium": {
            "type": "number"
          },
          "high": {
            "type": "number"
          }
        },
        "additionalProperties": false
      },
      "WaiverRecommendation": {
        "type": "object",
        "required": [
          "player",
          "projectedPoints",
          "faab",
          "priority",
          "recommendedAction"
        ],
        "properties": {
          "player": {
            "$ref": "#/components/schemas/PlayerSummary"
          },
          "projectedPoints": {
            "type": "number"
          },
          "faab": {
            "$ref": "#/components/schemas/FAABRange"
          },
          "priority": {
            "type": "integer",
            "minimum": 1
          },
          "recommendedAction": {
            "type": "string",
            "enum": [
              "add",
              "monitor",
              "avoid"
            ]
          },
          "reason": {
            "type": "string",
            "nullable": true
          },
          "replacementComparison": {
            "type": "object",
            "properties": {
              "dropPlayerId": {
                "$ref": "#/components/schemas/UUID",
                "nullable": true
              },
              "deltaPoints": {
                "type": "number",
                "nullable": true
              }
            },
            "additionalProperties": false,
            "nullable": true
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance"
          }
        },
        "additionalProperties": false
      },
      "WaiverListResponse": {
        "type": "object",
        "required": [
          "total",
          "page",
          "pageSize",
          "items"
        ],
        "properties": {
          "total": {
            "type": "integer",
            "minimum": 0
          },
          "page": {
            "type": "integer",
            "minimum": 1
          },
          "pageSize": {
            "type": "integer",
            "minimum": 1
          },
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/WaiverRecommendation"
            }
          }
        },
        "additionalProperties": false
      },
      "TradeAsset": {
        "type": "object",
        "required": [
          "type",
          "id",
          "teamId"
        ],
        "properties": {
          "type": {
            "type": "string",
            "enum": [
              "player",
              "pick",
              "fab"
            ]
          },
          "id": {
            "type": "string"
          },
          "teamId": {
            "$ref": "#/components/schemas/UUID"
          },
          "description": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "TradeEstimateRequest": {
        "type": "object",
        "required": [
          "leagueId",
          "fromTeamId",
          "toTeamId",
          "offer",
          "request"
        ],
        "properties": {
          "leagueId": {
            "$ref": "#/components/schemas/UUID"
          },
          "period": {
            "$ref": "#/components/schemas/ScoringPeriod"
          },
          "fromTeamId": {
            "$ref": "#/components/schemas/UUID"
          },
          "toTeamId": {
            "$ref": "#/components/schemas/UUID"
          },
          "offer": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TradeAsset"
            }
          },
          "request": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TradeAsset"
            }
          },
          "allowCounter": {
            "type": "boolean",
            "default": true
          },
          "includeWaiverAlternatives": {
            "type": "boolean",
            "default": false
          }
        },
        "additionalProperties": false
      },
      "TradeImpact": {
        "type": "object",
        "required": [
          "teamId",
          "projectedDelta"
        ],
        "properties": {
          "teamId": {
            "$ref": "#/components/schemas/UUID"
          },
          "projectedDelta": {
            "type": "number"
          },
          "riskDelta": {
            "type": "number",
            "nullable": true
          },
          "lineupChanges": {
            "type": "array",
            "items": {
              "type": "object",
              "required": [
                "slot",
                "inPlayerId",
                "outPlayerId"
              ],
              "properties": {
                "slot": {
                  "type": "string"
                },
                "inPlayerId": {
                  "$ref": "#/components/schemas/UUID"
                },
                "outPlayerId": {
                  "$ref": "#/components/schemas/UUID"
                }
              },
              "additionalProperties": false
            }
          },
          "notes": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "TradeEstimateResponse": {
        "type": "object",
        "required": [
          "fairnessScore",
          "recommendedAction",
          "teamImpacts",
          "provenance"
        ],
        "properties": {
          "fairnessScore": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "recommendedAction": {
            "type": "string",
            "enum": [
              "proceed",
              "counter",
              "decline"
            ]
          },
          "summary": {
            "type": "string",
            "nullable": true
          },
          "teamImpacts": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TradeImpact"
            }
          },
          "replacementImpact": {
            "type": "object",
            "properties": {
              "teamId": {
                "$ref": "#/components/schemas/UUID"
              },
              "delta": {
                "type": "number",
                "nullable": true
              }
            },
            "additionalProperties": false,
            "nullable": true
          },
          "warnings": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance"
          }
        },
        "additionalProperties": false
      },
      "RefreshRequest": {
        "type": "object",
        "properties": {
          "leagueId": {
            "$ref": "#/components/schemas/UUID",
            "nullable": true
          },
          "teamId": {
            "$ref": "#/components/schemas/UUID",
            "nullable": true
          },
          "force": {
            "type": "boolean",
            "default": false
          }
        },
        "additionalProperties": false
      },
      "RefreshResponse": {
        "type": "object",
        "required": [
          "scope",
          "status",
          "enqueuedAt"
        ],
        "properties": {
          "scope": {
            "$ref": "#/components/schemas/ScopeId"
          },
          "status": {
            "type": "string",
            "enum": [
              "queued",
              "in-progress",
              "skipped"
            ]
          },
          "enqueuedAt": {
            "type": "string",
            "format": "date-time"
          },
          "estimatedCompletion": {
            "type": "string",
            "format": "date-time",
            "nullable": true
          },
          "context": {
            "type": "object",
            "additionalProperties": true,
            "nullable": true
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "LiveImpactEvent": {
        "type": "object",
        "required": [
          "eventId",
          "gameId",
          "playId",
          "occurredAt",
          "headline",
          "impactType",
          "fantasyImplications"
        ],
        "properties": {
          "eventId": {
            "type": "string"
          },
          "gameId": {
            "type": "string"
          },
          "playId": {
            "type": "integer"
          },
          "occurredAt": {
            "type": "string",
            "format": "date-time"
          },
          "headline": {
            "type": "string"
          },
          "description": {
            "type": "string",
            "nullable": true
          },
          "impactType": {
            "type": "string",
            "enum": [
              "touchdown",
              "injury",
              "drive",
              "projection-update",
              "status"
            ]
          },
          "affectedPlayers": {
            "type": "array",
            "items": {
              "type": "object",
              "required": [
                "playerId",
                "team"
              ],
              "properties": {
                "playerId": {
                  "$ref": "#/components/schemas/UUID"
                },
                "team": {
                  "type": "string"
                },
                "impact": {
                  "type": "string",
                  "nullable": true
                },
                "pointsDelta": {
                  "type": "number",
                  "nullable": true
                }
              },
              "additionalProperties": false
            }
          },
          "fantasyImplications": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "provenance": {
            "$ref": "#/components/schemas/Provenance"
          },
          "links": {
            "type": "array",
            "items": {
              "type": "string",
              "format": "uri"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      }
    },
    "parameters": {
      "ProviderPath": {
        "name": "provider",
        "in": "path",
        "required": true,
        "schema": {
          "$ref": "#/components/schemas/ProviderId"
        }
      },
      "LeagueIdPath": {
        "name": "leagueId",
        "in": "path",
        "required": true,
        "schema": {
          "$ref": "#/components/schemas/UUID"
        }
      },
      "TeamIdPath": {
        "name": "teamId",
        "in": "path",
        "required": true,
        "schema": {
          "$ref": "#/components/schemas/UUID"
        }
      },
      "PlayerIdPath": {
        "name": "playerId",
        "in": "path",
        "required": true,
        "schema": {
          "$ref": "#/components/schemas/UUID"
        }
      },
      "ScopePath": {
        "name": "scope",
        "in": "path",
        "required": true,
        "schema": {
          "$ref": "#/components/schemas/ScopeId"
        }
      },
      "PageQuery": {
        "name": "page",
        "in": "query",
        "required": false,
        "schema": {
          "type": "integer",
          "minimum": 1,
          "default": 1
        }
      },
      "PageSizeQuery": {
        "name": "pageSize",
        "in": "query",
        "required": false,
        "schema": {
          "type": "integer",
          "minimum": 1,
          "maximum": 200,
          "default": 25
        }
      },
      "LeagueIdQuery": {
        "name": "leagueId",
        "in": "query",
        "required": true,
        "schema": {
          "$ref": "#/components/schemas/UUID"
        }
      }
    },
    "securitySchemes": {
      "sessionCookie": {
        "type": "apiKey",
        "in": "cookie",
        "name": "session"
      },
      "serviceToken": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}
